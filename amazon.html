<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Amazon Clone</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body { font-family: Arial; margin:0; background:#f4f4f4; }
header { display:flex; justify-content:space-between; align-items:center; padding:12px 20px; background:#232f3e; color:#fff; }
.header-left h1 { margin:0; font-size:20px; }
nav a { color:#fff; margin-left:14px; text-decoration:none; }
#productGrid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px,1fr));
  gap: 18px;
  padding: 20px;
}
.product-card {
  background: #fff;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0,0,0,0.06);
  display: flex;
  flex-direction: column;
}
.product-card img { width: 100%; height: 150px; object-fit: cover; }
.product-info { padding: 12px; flex-grow: 1; }
.add-btn {
  background: #ff9900;
  border: none;
  padding: 8px 10px;
  border-radius: 6px;
  color: #fff;
  cursor: pointer;
  width: 100%;
  font-weight: bold;
}
</style>
</head>
<body>
<header>
  <div class="header-left"><h1>Amazon Clone</h1></div>
  <nav>
    <a href="/amazon.html">Catalog</a>
    <a href="/cart.html">Cart</a>
    <a href="/payment.html">Payment</a>
    <a href="/api/logout" onclick="logout(event)">Logout</a>
  </nav>
</header>

<div id="productGrid"></div>

<script>
const API_BASE = 'https://amazon-backend-v0nz.onrender.com';

async function loadProducts() {
  try {
    const res = await fetch(API_BASE + '/api/products', { credentials: 'include' });
    const products = await res.json();
    renderProducts(products);
  } catch(e) {
    alert('Failed to load products');
  }
}

function renderProducts(products) {
  const grid = document.getElementById('productGrid');
  grid.innerHTML = '';
  products.forEach(product => {
    const card = document.createElement('div');
    card.className = 'product-card';
    card.innerHTML = `
      <img src="${product.image}" alt="${product.name}">
      <div class="product-info">
        <h3>${product.name}</h3>
        <p>â‚¹${product.price}</p>
        <button class="add-btn" onclick="addToCart(${product.id})">Add to Cart</button>
      </div>
    `;
    grid.appendChild(card);
  });
}

async function addToCart(id) {
  try {
    const res = await fetch(API_BASE + '/api/cart/add', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      credentials: 'include',
      body: JSON.stringify({ id, qty:1 })
    });
    const data = await res.json();
    if (!res.ok) alert(data.error || 'Failed to add to cart');
    else alert('Added to cart!');
  } catch(e) {
    alert('Error adding to cart');
  }
}

async function logout(e){
  e.preventDefault();
  await fetch(API_BASE + '/api/logout', { credentials:'include' });
  window.location.href='/login.html';
}

loadProducts();
</script>
</body>
</html>
